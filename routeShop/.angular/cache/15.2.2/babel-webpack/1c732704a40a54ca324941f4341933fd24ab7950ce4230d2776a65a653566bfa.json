{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n      label: 0,\n      sent: function () {\n        if (t[0] & 1) throw t[1];\n        return t[1];\n      },\n      trys: [],\n      ops: []\n    },\n    f,\n    y,\n    t,\n    g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n    while (g && (g = 0, op[0] && (_ = 0)), _) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n        case 7:\n          op = _.ops.pop();\n          _.trys.pop();\n          continue;\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n            _.ops.push(op);\n            break;\n          }\n          if (t[2]) _.ops.pop();\n          _.trys.pop();\n          continue;\n      }\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ShoppingCartService = void 0;\nvar shopping_cart_1 = require(\"../models/shopping-cart\");\nvar database_1 = require(\"angularfire2/database\");\nrequire(\"rxjs/add/operator/take\");\nrequire(\"rxjs/add/operator/map\");\nvar i0 = require(\"@angular/core\");\nvar ShoppingCartService = /** @class */function () {\n  function ShoppingCartService(db) {\n    this.db = db;\n  }\n  ShoppingCartService.prototype.getCart = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var cartId;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4 /*yield*/, this.getOrCreateCartId()];\n          case 1:\n            cartId = _a.sent();\n            return [2 /*return*/, this.db.object('/shopping-carts/' + cartId).map(function (x) {\n              return new shopping_cart_1.ShoppingCart(x.items);\n            })];\n        }\n      });\n    });\n  };\n  ShoppingCartService.prototype.addToCart = function (product) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        this.updateItem(product, 1);\n        return [2 /*return*/];\n      });\n    });\n  };\n\n  ShoppingCartService.prototype.removeFromCart = function (product) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        this.updateItem(product, -1);\n        return [2 /*return*/];\n      });\n    });\n  };\n\n  ShoppingCartService.prototype.clearCart = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var cartId;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4 /*yield*/, this.getOrCreateCartId()];\n          case 1:\n            cartId = _a.sent();\n            this.db.object('/shopping-carts/' + cartId + '/items').remove();\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n\n  ShoppingCartService.prototype.create = function () {\n    return this.db.list('/shopping-carts').push({\n      dateCreated: new Date().getTime()\n    });\n  };\n  ShoppingCartService.prototype.getItem = function (cartId, productId) {\n    return this.db.object('/shopping-carts/' + cartId + '/items/' + productId);\n  };\n  ShoppingCartService.prototype.getOrCreateCartId = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var cartId, result;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            cartId = localStorage.getItem('cartId');\n            if (cartId) return [2 /*return*/, cartId];\n            return [4 /*yield*/, this.create()];\n          case 1:\n            result = _a.sent();\n            localStorage.setItem('cartId', result.key);\n            return [2 /*return*/, result.key];\n        }\n      });\n    });\n  };\n  ShoppingCartService.prototype.updateItem = function (product, change) {\n    return __awaiter(this, void 0, void 0, function () {\n      var cartId, item$;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4 /*yield*/, this.getOrCreateCartId()];\n          case 1:\n            cartId = _a.sent();\n            item$ = this.getItem(cartId, product.$key);\n            item$.take(1).subscribe(function (item) {\n              var quantity = (item.quantity || 0) + change;\n              if (quantity === 0) item$.remove();else item$.update({\n                title: product.title,\n                imageUrl: product.imageUrl,\n                price: product.price,\n                quantity: quantity\n              });\n            });\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n\n  ShoppingCartService.ɵfac = function ShoppingCartService_Factory(t) {\n    i0.ɵɵinvalidFactory();\n  };\n  ShoppingCartService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: ShoppingCartService,\n    factory: ShoppingCartService.ɵfac\n  });\n  return ShoppingCartService;\n}();\nexports.ShoppingCartService = ShoppingCartService;","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA;AAEA;AAEAA;AACAA;;AAEA;EAGE,6BAAoBC,EAAuB;IAAvB,OAAE,GAAFA,EAAE;EAAyB;EAEzCC,qCAAO,GAAb;;;;;;YACe,qBAAM,IAAI,CAACC,iBAAiB,EAAE;;YAAvCC,MAAM,GAAGC,SAA8B;YAC3C,sBAAO,IAAI,CAACJ,EAAE,CAACK,MAAM,CAAC,kBAAkB,GAAGF,MAAM,CAAC,CAC/CG,GAAG,CAAC,WAAC;cAAI,WAAIC,4BAAY,CAACC,CAAC,CAACC,KAAK,CAAC;YAAzB,CAAyB,CAAC;QAAC;;;GACxC;EAEKR,uCAAS,GAAf,UAAgBS,OAAgB;;;QAC9B,IAAI,CAACC,UAAU,CAACD,OAAO,EAAE,CAAC,CAAC;;;;GAC5B;;EAEKT,4CAAc,GAApB,UAAqBS,OAAgB;;;QACnC,IAAI,CAACC,UAAU,CAACD,OAAO,EAAE,CAAC,CAAC,CAAC;;;;GAC7B;;EAEKT,uCAAS,GAAf;;;;;;YACe,qBAAM,IAAI,CAACC,iBAAiB,EAAE;;YAAvCC,MAAM,GAAGC,SAA8B;YAC3C,IAAI,CAACJ,EAAE,CAACK,MAAM,CAAC,kBAAkB,GAAGF,MAAM,GAAG,QAAQ,CAAC,CAACS,MAAM,EAAE;;;;;GAChE;;EAGOX,oCAAM,GAAd;IACE,OAAO,IAAI,CAACD,EAAE,CAACa,IAAI,CAAC,iBAAiB,CAAC,CAACC,IAAI,CAAC;MAC1CC,WAAW,EAAE,IAAIC,IAAI,EAAE,CAACC,OAAO;KAChC,CAAC;EACJ,CAAC;EAEOhB,qCAAO,GAAf,UAAgBE,MAAc,EAAEe,SAAiB;IAC/C,OAAO,IAAI,CAAClB,EAAE,CAACK,MAAM,CAAC,kBAAkB,GAAGF,MAAM,GAAG,SAAS,GAAGe,SAAS,CAAC;EAC5E,CAAC;EAEajB,+CAAiB,GAA/B;;;;;;YACME,MAAM,GAAGgB,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAC;YAC3C,IAAIjB,MAAM,EAAE,sBAAOA,MAAM;YAEZ,qBAAM,IAAI,CAACkB,MAAM,EAAE;;YAA5BC,MAAM,GAAGlB,SAAmB;YAChCe,YAAY,CAACI,OAAO,CAAC,QAAQ,EAAED,MAAM,CAACE,GAAG,CAAC;YAC1C,sBAAOF,MAAM,CAACE,GAAG;QAAC;;;GACnB;EAEavB,wCAAU,GAAxB,UAAyBS,OAAgB,EAAEe,MAAc;;;;;;YAC1C,qBAAM,IAAI,CAACvB,iBAAiB,EAAE;;YAAvCC,MAAM,GAAGC,SAA8B;YACvCsB,KAAK,GAAG,IAAI,CAACN,OAAO,CAACjB,MAAM,EAAEO,OAAO,CAACiB,IAAI,CAAC;YAC9CD,KAAK,CAACE,IAAI,CAAC,CAAC,CAAC,CAACC,SAAS,CAAC,cAAI;cAC1B,IAAIC,QAAQ,GAAG,CAACC,IAAI,CAACD,QAAQ,IAAI,CAAC,IAAIL,MAAM;cAC5C,IAAIK,QAAQ,KAAK,CAAC,EAAEJ,KAAK,CAACd,MAAM,EAAE,CAAC,KAC9Bc,KAAK,CAACM,MAAM,CAAC;gBAChBC,KAAK,EAAEvB,OAAO,CAACuB,KAAK;gBACpBC,QAAQ,EAAExB,OAAO,CAACwB,QAAQ;gBAC1BC,KAAK,EAAEzB,OAAO,CAACyB,KAAK;gBACpBL,QAAQ,EAAEA;eACX,CAAC;YACJ,CAAC,CAAC;;;;;GACH;;;;;;WAxDU7B,mBAAmB;IAAAmC,SAAnBnC,mBAAmB;EAAA;4BAThC;CAkEC,EA1DD;AACaoC","names":["require","db","ShoppingCartService","getOrCreateCartId","cartId","_a","object","map","shopping_cart_1","x","items","product","updateItem","remove","list","push","dateCreated","Date","getTime","productId","localStorage","getItem","create","result","setItem","key","change","item$","$key","take","subscribe","quantity","item","update","title","imageUrl","price","factory","exports"],"sourceRoot":"","sources":["C:\\Angular\\routeShop\\src\\app\\shared\\services\\shopping-cart.service.ts"],"sourcesContent":["import { Observable } from 'rxjs/Observable';\nimport { ShoppingCart } from '../models/shopping-cart';\nimport { Product } from '../models/product';\nimport { AngularFireDatabase, FirebaseObjectObservable } from 'angularfire2/database';\nimport { Injectable } from '@angular/core';\nimport 'rxjs/add/operator/take'; \nimport 'rxjs/add/operator/map'; \n\n@Injectable()\nexport class ShoppingCartService {\n\n  constructor(private db: AngularFireDatabase) { }\n\n  async getCart(): Promise<Observable<ShoppingCart>> {\n    let cartId = await this.getOrCreateCartId();\n    return this.db.object('/shopping-carts/' + cartId)\n      .map(x => new ShoppingCart(x.items));\n  }\n\n  async addToCart(product: Product) { \n    this.updateItem(product, 1);\n  }\n\n  async removeFromCart(product: Product) {\n    this.updateItem(product, -1);\n  }\n\n  async clearCart() { \n    let cartId = await this.getOrCreateCartId();\n    this.db.object('/shopping-carts/' + cartId + '/items').remove();\n  }\n  \n\n  private create() { \n    return this.db.list('/shopping-carts').push({\n      dateCreated: new Date().getTime()\n    });\n  }\n\n  private getItem(cartId: string, productId: string) {\n    return this.db.object('/shopping-carts/' + cartId + '/items/' + productId);\n  }\n\n  private async getOrCreateCartId(): Promise<string> { \n    let cartId = localStorage.getItem('cartId');\n    if (cartId) return cartId; \n\n    let result = await this.create();\n    localStorage.setItem('cartId', result.key);\n    return result.key;\n  }\n\n  private async updateItem(product: Product, change: number) {\n    let cartId = await this.getOrCreateCartId();\n    let item$ = this.getItem(cartId, product.$key);\n    item$.take(1).subscribe(item => {\n      let quantity = (item.quantity || 0) + change;\n      if (quantity === 0) item$.remove();\n      else item$.update({ \n        title: product.title,\n        imageUrl: product.imageUrl,\n        price: product.price,\n        quantity: quantity\n      });\n    });\n  }\n}\n"]},"metadata":{},"sourceType":"script","externalDependencies":[]}